<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QBIT TRIVIA - Pro Edition</title>

<style>
:root{
--bg-dark:#1a1f32;
--card-bg:#242a45;
--text-red:#ff4d6d;
--accent-green:#00e676;
--btn-blue:#2d365d;
--text-dim:#8a94b8;
}

body{
background:var(--bg-dark);
color:white;
font-family:'Arial Black',sans-serif;
display:flex;
justify-content:center;
align-items:center;
min-height:100vh;
margin:0;
overflow:hidden;
}

.timer-container{
width:100%;
height:8px;
background:#1e2640;
position:absolute;
top:0;left:0;
}
#timer-bar{
width:100%;
height:100%;
background:var(--accent-green);
transition:width .1s linear;
}

.container{
background:var(--card-bg);
width:90%;
max-width:420px;
padding:30px;
border-radius:20px;
text-align:center;
box-shadow:0 15px 40px rgba(0,0,0,.6);
position:relative;
}

.hidden{display:none}

.option-btn{
background:var(--btn-blue);
color:white;
padding:14px;
width:100%;
margin-bottom:10px;
border-radius:12px;
border:2px solid transparent;
font-weight:bold;
cursor:pointer;
transition:.2s;
}
.option-btn:hover:not(:disabled){
background:#3d4670;
border-color:var(--accent-green);
transform:scale(1.02);
}
.option-btn:disabled{opacity:.6}

.score-bar{
margin-top:20px;
padding-top:15px;
border-top:2px solid #3d4670;
display:flex;
justify-content:space-between;
color:var(--accent-green);
font-family:sans-serif;
font-weight:bold;
}

.time-msg{
font-size:.8rem;
color:var(--text-dim);
margin-top:10px;
font-family:sans-serif;
min-height:1.8rem;
}

.flash-success{box-shadow:0 0 30px var(--accent-green)}
.flash-error{box-shadow:0 0 30px var(--text-red)}

input{
padding:12px;
border-radius:10px;
border:none;
width:100%;
margin:15px 0;
font-size:1rem;
}
button.start-btn{
background:var(--accent-green);
border:none;
padding:14px;
width:100%;
border-radius:12px;
font-weight:bold;
cursor:pointer;
margin-top:10px;
}
.rank{
font-family:sans-serif;
font-size:.85rem;
margin-top:10px;
text-align:left;
}
</style>
</head>

<body>

<div class="timer-container"><div id="timer-bar"></div></div>

<!-- MEN√ö -->
<div class="container" id="menu">
<h1>QBIT TRIVIA</h1>
<p style="color:var(--text-dim)">Pon a prueba tu velocidad mental</p>
<input id="playerName" placeholder="Ingresa tu nombre">
<button class="start-btn" onclick="startGame()">Iniciar partida</button>
</div>

<!-- JUEGO -->
<div class="container hidden" id="game">
<h1>QBIT TRIVIA</h1>
<div id="question">Cargando...</div>
<div id="meta-container" class="time-msg"></div>
<div id="options-container"></div>

<div class="score-bar">
<span><span id="player-label"></span> ‚Ä¢ SCORE: <span id="score-value">0</span></span>
<span id="counter">1 / 10</span>
</div>

<div id="time-result" class="time-msg"></div>
</div>

<!-- FINAL -->
<div class="container hidden" id="end">
<h1>üèÅ Fin de la partida</h1>
<p id="final-player"></p>
<p id="final-score"></p>

<h3>üèÜ Ranking</h3>
<div id="ranking" class="rank"></div>

<button class="start-btn" onclick="restart()">Volver a intentar</button>
</div>

<!-- SONIDOS -->
<audio id="snd-ok" src="https://assets.mixkit.co/sfx/preview/mixkit-audience-clapping-strongly-476.mp3"></audio>
<audio id="snd-bad" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3"></audio>
<audio id="snd-time" src="https://assets.mixkit.co/sfx/preview/mixkit-warning-alarm-buzzer-991.mp3"></audio>

<script>
let score=0,startTime,timer;
let questionCount=0;
let streak=0;
const MAX_QUESTIONS=10;
const TIME_LIMIT=15;
const API_URL="https://qbit-e6gb.onrender.com/pregunta-random";

function startGame(){
score=0; streak=0; questionCount=0;
document.getElementById("score-value").innerText=0;
document.getElementById("menu").classList.add("hidden");
document.getElementById("end").classList.add("hidden");
document.getElementById("game").classList.remove("hidden");
document.getElementById("player-label").innerText=
document.getElementById("playerName").value||"Jugador";
fetchNewQuestion();
}

function restart(){
document.getElementById("end").classList.add("hidden");
document.getElementById("menu").classList.remove("hidden");
}

function deepClean(t){return t?.toString().trim().replace(/^['"]|['"]$/g,'')||""}

function parseOptions(o){
if(Array.isArray(o)&&o.length===1)return parseOptions(o[0]);
if(Array.isArray(o))return o.map(deepClean);
if(typeof o==="string"){
try{return JSON.parse(o.replace(/'/g,'"')).map(deepClean)}catch{return[]}
}
return[];
}

async function fetchNewQuestion(){
if(questionCount>=MAX_QUESTIONS)return endGame();
questionCount++;
document.getElementById("counter").innerText=`${questionCount} / ${MAX_QUESTIONS}`;

clearInterval(timer);
const opt=document.getElementById("options-container");
const bar=document.getElementById("timer-bar");
const msg=document.getElementById("time-result");
opt.innerHTML="";
msg.innerText="";
bar.style.width="100%";

const r=await fetch(API_URL+"?t="+Date.now());
const d=await r.json();

document.getElementById("question").innerText=deepClean(d.pregunta);
document.getElementById("meta-container").innerText=`${d.categoria} ‚Ä¢ ${d.dificultad}`;

parseOptions(d.opciones).forEach(o=>{
const b=document.createElement("button");
b.className="option-btn";
b.innerText=o;
b.onclick=()=>check(o,d.correcta);
opt.appendChild(b);
});

startTime=Date.now();
startTimer();
}

function startTimer(){
const bar=document.getElementById("timer-bar");
timer=setInterval(()=>{
const t=(Date.now()-startTime)/1000;
bar.style.width=Math.max(0,(1-t/TIME_LIMIT)*100)+"%";
if(t>=TIME_LIMIT){
clearInterval(timer);
streak=0;
document.getElementById("snd-time").play();
setTimeout(fetchNewQuestion,1500);
}
},50);
}

function check(sel,correct){
clearInterval(timer);
const cleanCorrect=deepClean(correct);
const time=(Date.now()-startTime)/1000;
let pts=Math.max(2,Math.ceil((TIME_LIMIT-time)*2));
const msg=document.getElementById("time-result");
const card=document.getElementById("game");

if(sel===cleanCorrect){
streak++;
if(streak%3===0){pts+=10; msg.innerText=`üî• BONUS +10 pts\n`;}
score+=pts;
document.getElementById("score-value").innerText=score;
document.getElementById("snd-ok").play();
msg.innerText+=`‚úÖ Correcto | +${pts} pts`;
card.classList.add("flash-success");
}else{
streak=0;
document.getElementById("snd-bad").play();
msg.innerText=`‚ùå Incorrecto\n‚úî Respuesta correcta: ${cleanCorrect}`;
card.classList.add("flash-error");
}

setTimeout(()=>{
card.classList.remove("flash-success","flash-error");
fetchNewQuestion();
},2200);
}

function endGame(){
clearInterval(timer);
document.getElementById("game").classList.add("hidden");
document.getElementById("end").classList.remove("hidden");
const name=document.getElementById("player-label").innerText;
document.getElementById("final-player").innerText=`Jugador: ${name}`;
document.getElementById("final-score").innerText=`Puntaje final: ${score}`;

let ranking=JSON.parse(localStorage.getItem("qbit-ranking")||"[]");
ranking.push({name,score});
ranking.sort((a,b)=>b.score-a.score);
ranking=ranking.slice(0,5);
localStorage.setItem("qbit-ranking",JSON.stringify(ranking));

document.getElementById("ranking").innerHTML=
ranking.map((r,i)=>`${i+1}. ${r.name} ‚Äî ${r.score} pts`).join("<br>");
}
</script>

</body>
</html>
